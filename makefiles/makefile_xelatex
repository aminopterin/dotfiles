# Filename: makefile
# Author: Tzu-Yu Jeng
# Date: Jan. 2017
# Description: to export all `.tex` (xeLaTeX) files into `.pdf` with `xelatex`
# Requirement: that `xelatex` be installed

# to call bash shell for recipe
SHELL := /usr/bin/env bash

# to specify location of program
PRG := $${HOME}/run_xelatex.sh

# to hold message displayed in the beginning
MSG := Now exporting all xeLaTeX's to Pdf's in the current directory...

# to set the xeLaTeX source files, either in root or in a subfolder (but no deeper);
# it's forbidden to contain whitespace ` ` in filename, or Makefile would separate them
SRC = $(wildcard *.tex */*.tex */*/*.tex)

# to replace all `.tex` with `.pdf`
BIN = $(SRC:.tex=.pdf)

# other affiliated files
AUX = $(wildcard *.aux */*.aux */*/*.aux)
LOG = $(wildcard *.log */*.log */*/*.log)
GZ = $(wildcard *.gz */*.gz */*/*.gz)

# to delete binary files
RM := rm -f

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

# for release
all : message $(BIN)

# output pre-build message
message :
	@echo $(MSG)

./%.pdf : ./%.tex
	@echo Compiling "$@" from "$<" ...
	@$(PRG) "$<"

.PHONY : all message clean 

clean :
	$(RM) "$(BIN)" "$(AUX)" "$(LOG)" "$(GZ)"
